# Cursor Agent Configuration for Claude Code AWS Bedrock Integration
# This file orchestrates the entire project execution through Linear automation

version: "1.0"
project:
  name: "Claude Code AWS Bedrock Integration"
  description: "Integration of Claude Code with AWS Bedrock for Cursor IDE"
  repository: "https://github.com/evgenygurin/claude-clode-cloud.git"
  linear_project: "WOR"

# Agent Configuration
agent:
  name: "Claude Code Bedrock Agent"
  version: "1.0"
  enabled: true
  auto_start: true

  capabilities:
    - read_linear_issues
    - create_github_branches
    - generate_code_from_requirements
    - manage_git_commits
    - update_linear_progress
    - post_comments
    - run_tests
    - update_github_status
    - trigger_ci_cd

# Linear API Integration
linear:
  api_key: "${LINEAR_API_KEY}"
  workspace: "workdev"
  team_id: "7b62d335-113b-4591-af4d-e3734df7eec6"
  project_key: "WOR"

  # Real-time synchronization
  real_time_sync:
    enabled: true
    subscription_enabled: true
    update_interval_seconds: 30

  # Automation trigger events
  automation_rules:
    - name: "Start work on issue"
      trigger: "issue_moved_to_in_progress"
      conditions:
        - field: "status"
          operator: "equals"
          value: "In Progress"
      actions:
        - type: "assign_to_agent"
        - type: "create_github_branch"
        - type: "post_comment"
          message: "ü§ñ Cursor Agent –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ–π"

    - name: "Work on next phase"
      trigger: "issue_completed"
      conditions:
        - field: "status"
          operator: "equals"
          value: "Done"
      actions:
        - type: "move_next_phase"
        - type: "post_comment"
          message: "‚úÖ –§–∞–∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! Cursor Agent –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Ñ–∞–∑—É"

    - name: "Handle blockers"
      trigger: "issue_labeled"
      conditions:
        - field: "labels"
          operator: "contains"
          value: "blocked"
      actions:
        - type: "post_comment"
          message: "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω blocker. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å."
        - type: "notify_slack"
          channel: "#engineering"

# GitHub Integration
github:
  repository: "evgenygurin/claude-clode-cloud"
  owner: "evgenygurin"
  default_branch: "main"

  # Branch naming and creation
  branch_naming_pattern: "eagurin/wor-{issue_number}-{title_slug}"
  auto_create_branch: true
  delete_branch_on_close: false

  # Commit configuration
  commit:
    author_name: "Cursor Agent"
    author_email: "cursor@agent.local"
    sign_commits: false

    # Conventional commit format
    message_template: |
      {type}({scope}): {description}

      {body}

      Closes WOR-{issue_number}

      ü§ñ Generated with Cursor Agent
      Co-Authored-By: Cursor Agent <cursor@agent.local>

  # Pull Request settings
  pull_request:
    create_draft: false
    auto_create_pr: true
    request_reviews: true
    reviewers: []  # Will be set by GitHub team

    description_template: |
      ## Description
      {description}

      **Related Issue**: WOR-{issue_number}

      ## Changes
      - {changes}

      ## Checklist
      - [ ] Code follows style guidelines
      - [ ] Tests added/updated
      - [ ] Documentation updated
      - [ ] No breaking changes

      ü§ñ *Generated by Cursor Agent*

  # Status checks
  require_status_checks: true
  required_checks:
    - "build"
    - "test"
    - "lint"
    - "security"

# Phase Configuration and Workflow
phases:
  - id: 1
    issue_id: "WOR-8"
    title: "AWS Infrastructure Setup üîß"
    priority: "critical"
    dependencies: []
    estimated_hours: 8

    requirements:
      - "Setup AWS account with Bedrock access"
      - "Configure IAM policies"
      - "Create Terraform IaC for AWS resources"
      - "Setup AWS CLI v2"

    deliverables:
      - "terraform/" # Directory with all Terraform files
      - "scripts/setup-aws.sh" # AWS setup script
      - "terraform/iam.tf" # IAM policies
      - "terraform/outputs.tf" # Output values

    success_criteria:
      - "All Terraform files created and validated"
      - "IAM policies configured correctly"
      - "AWS resources ready for provisioning"

  - id: 2
    issue_id: "WOR-9"
    title: "Claude Code Configuration ‚öôÔ∏è"
    priority: "critical"
    dependencies: ["WOR-8"]
    estimated_hours: 6

    requirements:
      - "Create .env.example with all variables"
      - "Create configure-claude-code.sh script"
      - "Create validate-config.sh script"
      - "Document all environment variables"

    deliverables:
      - ".env.example"
      - "scripts/configure-claude-code.sh"
      - "scripts/validate-config.sh"
      - "docs/CONFIGURATION.md"

  - id: 3
    issue_id: "WOR-10"
    title: "Authentication Methods üîê"
    priority: "critical"
    dependencies: ["WOR-9"]
    estimated_hours: 5

    requirements:
      - "Implement AWS CLI authentication"
      - "Implement Environment Variables method"
      - "Implement SSO Profile method"
      - "Implement Bedrock API Keys method"
      - "Create unified validation script"

    deliverables:
      - "scripts/auth-cli.sh"
      - "scripts/auth-env.sh"
      - "scripts/auth-sso.sh"
      - "scripts/auth-token.sh"
      - "scripts/validate-auth.sh"
      - "docs/AUTHENTICATION.md"

  - id: 4
    issue_id: "WOR-11"
    title: "Cursor Integration & Workarounds ‚ö†Ô∏è"
    priority: "critical"
    dependencies: ["WOR-10"]
    estimated_hours: 12

    requirements:
      - "Develop LLM Gateway Proxy (Option B)"
      - "Create OpenAI-compatible API wrapper"
      - "Document all 3 workaround options"
      - "Create monitoring for Cursor updates"

    deliverables:
      - "src/gateway/" # Gateway implementation
      - "gateway/Dockerfile"
      - "docs/CURSOR_INTEGRATION.md"
      - "docs/WORKAROUNDS.md"
      - "scripts/monitor-cursor-updates.sh"

  - id: 5
    issue_id: "WOR-12"
    title: "Docker Containerization üê≥"
    priority: "high"
    dependencies: ["WOR-11"]
    estimated_hours: 8

    requirements:
      - "Create multi-stage Dockerfile"
      - "Create Docker Compose for development"
      - "Create Docker Compose for production"
      - "Implement security hardening"

    deliverables:
      - "Dockerfile"
      - "docker-compose.yml"
      - "docker-compose.prod.yml"
      - ".dockerignore"
      - "docs/DOCKER.md"

  - id: 6
    issue_id: "WOR-13"
    title: "CI/CD Pipeline üîÑ"
    priority: "high"
    dependencies: ["WOR-12"]
    estimated_hours: 10

    requirements:
      - "Create test workflow"
      - "Create terraform validation workflow"
      - "Create security scanning workflow"
      - "Create Docker build/push workflow"
      - "Create deployment workflow"
      - "Setup integration tests for Bedrock"

    deliverables:
      - ".github/workflows/test.yml"
      - ".github/workflows/terraform.yml"
      - ".github/workflows/security.yml"
      - ".github/workflows/docker.yml"
      - ".github/workflows/deploy.yml"
      - "tests/integration/"

  - id: 7
    issue_id: "WOR-14"
    title: "Documentation üìö"
    priority: "high"
    dependencies: ["WOR-13"]
    estimated_hours: 8

    requirements:
      - "Create comprehensive README (RU & EN)"
      - "Create CLAUDE.md for Claude Code"
      - "Create architecture documentation"
      - "Create troubleshooting guide"
      - "Create architecture diagrams"

    deliverables:
      - "README.md"
      - "README.en.md"
      - "CLAUDE.md"
      - "docs/ARCHITECTURE.md"
      - "docs/CONFIGURATION.md"
      - "docs/AUTHENTICATION.md"
      - "docs/CURSOR_INTEGRATION.md"
      - "docs/TROUBLESHOOTING.md"
      - "docs/diagrams/"

  - id: 8
    issue_id: "WOR-15"
    title: "Monitoring & Cost Optimization üìä"
    priority: "medium"
    dependencies: ["WOR-14"]
    estimated_hours: 6

    requirements:
      - "Create token usage tracking system"
      - "Create AWS cost analyzer"
      - "Create performance monitoring"
      - "Setup regional cost comparison"

    deliverables:
      - "src/monitoring/"
      - "src/monitoring/token_tracker.py"
      - "src/monitoring/cost_analyzer.py"
      - "src/monitoring/performance_monitor.py"
      - "scripts/generate-cost-report.sh"
      - "docs/MONITORING.md"

  - id: 9
    issue_id: "WOR-16"
    title: "Linear + Cursor Agent Configuration ü§ñ"
    priority: "critical"
    dependencies: ["WOR-15"]
    estimated_hours: 4

    requirements:
      - "Setup all Linear automation rules"
      - "Configure Cursor Agent integration"
      - "Create GraphQL query collection"
      - "Setup real-time progress tracking"

    deliverables:
      - "linear-automation/"
      - "linear-automation/setup-automation.sh"
      - "linear-automation/graphql-queries.graphql"
      - ".cursor-agent/prompts/"
      - "docs/AUTOMATION.md"
      - "docs/GRAPHQL_INTEGRATION.md"

# Progress Tracking Configuration
progress:
  # Update Linear progress every 15 minutes
  update_interval_minutes: 15

  # Post daily summary
  post_daily_summary: true
  daily_summary_time: "18:00"  # UTC

  # Metrics to track
  track_metrics:
    - code_lines_generated
    - commits_created
    - branches_created
    - prs_created
    - tests_coverage
    - documentation_completeness
    - phase_completion_percentage
    - estimated_vs_actual_hours

  # Store metrics locally
  metrics_file: ".cursor-agent/metrics.json"

  # Store execution log
  execution_log: ".cursor-agent/execution.log"

# Notifications Configuration
notifications:
  # Linear notifications
  linear:
    enabled: true
    post_comments: true
    update_progress: true

    # Post comment on:
    comment_triggers:
      - phase_started
      - phase_completed
      - blocker_detected
      - test_failure
      - deployment_success

  # Slack notifications (optional)
  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#engineering"
    notify_on:
      - phase_completed
      - blocker_detected
      - deployment_success
      - daily_summary

  # Email notifications (optional)
  email:
    enabled: false
    recipients: ["your-email@example.com"]
    notify_on:
      - phase_completed
      - all_phases_completed

# Error Handling and Retry Logic
error_handling:
  max_retries: 3
  retry_backoff_seconds: 5
  retry_backoff_multiplier: 2

  # Specific error handling
  on_api_error:
    action: "retry_with_backoff"

  on_git_conflict:
    action: "notify_and_wait"

  on_test_failure:
    action: "retry_once"

  on_deployment_failure:
    action: "rollback_and_notify"

# Logging Configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "json"  # json or text

  outputs:
    - type: "file"
      path: ".cursor-agent/execution.log"
      rotation: "daily"
      retention_days: 30

    - type: "console"
      enabled: true

    - type: "linear"
      enabled: true
      min_level: "WARNING"

# Performance and Rate Limiting
performance:
  # API rate limiting
  linear_api_rate_limit: 100  # requests per minute
  github_api_rate_limit: 60   # requests per minute

  # Parallel phase execution
  max_parallel_phases: 1  # Execute phases sequentially

  # Resource limits
  max_file_size_mb: 100
  max_commit_message_length: 500
  max_files_per_commit: 50

# Security Configuration
security:
  # Don't commit sensitive files
  exclude_patterns:
    - "*.env"
    - "*.env.local"
    - ".aws/"
    - ".git/credentials"
    - "secrets/"
    - "*.pem"
    - "*.key"

  # Scan for secrets before commit
  scan_for_secrets: true

  # Don't push secrets to GitHub
  prevent_secret_push: true

# Post-Execution Configuration
post_execution:
  # After all phases completed
  on_success:
    - type: "post_comment"
      message: "üéâ –í—Å–µ —Ñ–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
    - type: "close_issue"
      issue_id: "WOR-7"
    - type: "create_release"
      version: "1.0.0"
    - type: "post_summary"

  # On any failure
  on_failure:
    - type: "post_comment"
      message: "‚ùå –ü—Ä–æ–µ–∫—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–∞–º–∏"
    - type: "notify_slack"
    - type: "create_issue"
      title: "Fix project execution errors"

# Testing Configuration
testing:
  run_tests: true
  coverage_minimum_percent: 80

  test_commands:
    - "pytest tests/ -v"
    - "terraform validate"
    - "trivy image claude-code:latest"

  fail_on_test_failure: true

# Deployment Configuration
deployment:
  environments:
    - name: "staging"
      enabled: true
      auto_deploy: false

    - name: "production"
      enabled: true
      auto_deploy: false
      require_approval: true

# Misc Configuration
misc:
  # Create initial project structure
  initialize_repo: true

  # Generate .gitignore
  generate_gitignore: true

  # Create initial commit
  create_initial_commit: true

  # Push to remote
  push_to_remote: true

  # Create releases
  create_releases: true
